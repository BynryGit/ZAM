<!DOCTYPE html>
<html>
<head>
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Page title -->
    <title>ZAM | Edit Focus List </title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

    <!-- Vendor styles -->
    <link rel="stylesheet" href="{% static 'vendor/fontawesome/css/font-awesome.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/metisMenu/dist/metisMenu.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/animate.css/animate.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/bootstrap/dist/css/bootstrap.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/sweetalert/lib/sweet-alert.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/select2-3.5.2/select2.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/select2-bootstrap/select2-bootstrap.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'vendor/datatables_plugins/integration/bootstrap/3/dataTables.bootstrap.css' %}"/>

    <!-- App styles -->
    <link rel="stylesheet" href="{% static 'fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css' %}"/>
    <link rel="stylesheet" href="{% static 'fonts/pe-icon-7-stroke/css/helper.css' %}"/>
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/animate.css/dropzone.css' %}"/>
    <link rel="stylesheet" href="{% static 'vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker.css' %}"/>
    <style type="text/css">
        .wid {
            min-width: 65px;
        }

        .btn-success.btn-outline:hover {
            background-color: #62cb31;
        }

        .baccol {
            background-color: #0A37B8;
        }

        .font-col {
            color: #FFFFFF;

        }

        .lege {
            padding-bottom: 1%;

        }

        #side-menu li.active a {
            background-color: #7160A9 !important;
            color: #fff;

        }

        #side-menu li:hover a {
            background-color: #7160A9 !important;
            color: #fff;

        }

        .btn-primary2:hover {
            background-color: #7160A9 !important;
            border-color: #7160A9 !important;
            color: #FFFFFF
        }

        .btn-primary2.btn-outline:hover {
            color: #6a6c6f;
        !important;
            color: #FFFFFF;

        }

        .btn-primary2.btn-outline {
            color: #6a6c6f;
        !important;
        }

        .btn-primary2 {
            border-color: #7160A9 !important;
        }

        .bac-clr {
            background: linear-gradient(to left, #fff -20%, #7160A9 40%) repeat scroll 0% 0% !important;
            border: 1px solid #E4E5E7;
            border-radius: 2px;
            padding: 20px;
            position: relative;
        }

        #side-menu li.treeview ul li a {
            background: #fff !important;
            color: #6A6C6F !important;
            font-weight: 700;
        }

        #side-menu li.treeview ul li.active a {
            background-color: #7160A9 !important;
            color: #FFF !important;
        }

        #side-menu li.treeview ul li:hover a {
            background-color: #7160A9 !important;
            color: #fff !important;

        }

        .hpanel.hblue .panel-body {
            border-top: 2px solid #7160A9;
        }

        .label-success {
            background-color: #7160A9;
        }

        .small-logo {
            display: none;
            text-align: center;
            padding-top: 6px;
            font-size: 28px;
            font-weight: 800;
            float: left;
            display: block;
            color: #7160A9;
        }

        .text-primary {
            color: #7160A9;
        }

        #wizardControl .nav-tabs .active a {
            background-color: #7160A9 !important;
            color: #fff;
        }

        textarea.form-control {
            height: 150px;
        }
    </style>
</head>
<body>

<!-- Simple splash screen-->
<div class="splash">
    <div class="splash-title"><img src="{% static 'images/loading-bars.gif' %}" width="64" height="64"/></div>
</div>
<!--[if lt IE 7]>
<p class="alert alert-danger">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<!-- Header -->
<div id="header">

    <!-- <div id="logo" class="light-version">
        <span>
           ZAM
        </span>
    </div> -->
    <nav role="navigation">
        <div class="header-link hide-menu"><i class="fa fa-bars"></i></div>
        <div class="small-logo">
            <span class="text-primary">Zeus Asset Management</span>
        </div>

        <div class="navbar-right">
            <ul class="nav navbar-nav no-borders">
                <li class="dropdown">
                    <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                        <i class="pe-7s-speaker"></i>
                    </a>
                    <ul class="dropdown-menu hdropdown notification animated flipInX">
                        <li>
                            <a>
                                <span class="label label-success">NEW</span> It is a long established.
                            </a>
                        </li>
                        <li>
                            <a>
                                <span class="label label-warning">WAR</span> There are many variations.
                            </a>
                        </li>
                        <li>
                            <a>
                                <span class="label label-danger">ERR</span> Contrary to popular belief.
                            </a>
                        </li>
                        <li class="summary"><a href="#">See all notifications</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle label-menu-corner" href="#" data-toggle="dropdown">
                        <i class="pe-7s-mail"></i>
                        <span class="label label-success"></span>
                    </a>
                    <ul class="dropdown-menu hdropdown animated flipInX">
                        <div class="title">
                            You have 4 new messages
                        </div>
                        <li>
                            <a>
                                It is a long established.
                            </a>
                        </li>
                        <li>
                            <a>
                                There are many variations.
                            </a>
                        </li>
                        <li>
                            <a>
                                Lorem Ipsum is simply dummy.
                            </a>
                        </li>
                        <li>
                            <a>
                                Contrary to popular belief.
                            </a>
                        </li>
                        <li class="summary"><a href="#">See All Messages</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="/signing-out/">
                        <i title="Logout" class="pe-7s-upload pe-rotate-90"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</div>

<!-- Navigation -->
<aside id="menu">
    <div id="navigation">
        <div class="profile-picture">
            <div>
                <img src="{% static 'images/images.png' %}" class="img-circle m-b" alt="logo">
            </div>

            <div class="stats-label text-color">
                <span class="font-extra-bold">{{ request.session.full_name }}</span><br>
                <small class="text-muted">{{ request.session.user_role }}</small>

            </div>
        </div>

        <ul class="nav" id="side-menu">
            {% if request.session.user_role == 'Portfolio Manager' or request.session.user_role == 'Super Admin' or request.session.user_role == 'Marketing Manager' %}
                <li>
                    <a href="/crm-index/"> <span class="nav-label">Client Relationship Management</span></a>
                </li>
            {% endif %}
            {% if request.session.user_role == 'Portfolio Manager' or request.session.user_role == 'Super Admin' or request.session.user_role == 'Analyst' %}
            <li class="active"><a href="/open-research-page/?tab_id=1">Research</a></li>
            {% endif %}
                <li ><a href="/open-discussion-forum/">Discussion Forum</a></li>
              {% if request.session.user_role == 'Portfolio Manager' or request.session.user_role == 'Super Admin' or request.session.user_role == 'Analyst' %}
                <li class="treeview">
                <a href="#"><span class="nav-label">Security Data Management</span><span class="fa arrow"></span> </a>
                <ul class="nav nav-second-level">
                    <li><a href="/open-security-page/">Security</a></li>
                    <li><a href="/open-security-price-page/">Price</a></li>
                </ul>
            </li>
            {% endif %}
	        {% if request.session.user_role == 'Portfolio Manager' or request.session.user_role == 'Super Admin' %}
	           <li>
	                    <a href="/open-trade/"> <span class="nav-label">Trade</span></a>
	                </li>
	                <li>
	                    <a href="/open-position/"> <span class="nav-label">Position</span></a>
	                </li>
	        {% endif %} 
                    <li>
                <a href="/index/"> <span class="nav-label">Dashboard</span></a>
            </li>
            {% if request.session.user_role == 'Super Admin' %}             <li class="treeview"><a href="#"><span class="nav-label">Planning Tool</span><span class="fa arrow"></span>             </a>                 <ul class="nav nav-second-level">                     <li><a href="/open-YFinAdvisor-index/">Planning Tool Input</a></li>                     <li><a href="/open-YFinAdvisor-customer/">Customer</a></li>                 </ul>             </li>             {% endif %} {% if request.session.user_role == 'Super Admin' or request.session.user_role == 'Admin' %}             <li><a href="/open-user-index/"> <span class="nav-label">User Management</span></a></li>             {% endif %}
                <li>
                    <a href="/open-rename-password/"> <span class="nav-label">Change Password</span></a>
                </li>
        </ul>
    </div>
</aside>

<!-- Main Wrapper -->
<div id="wrapper">


    <div class="normalheader transition animated fadeIn">
        <div class="hpanel baccol">
            <div class="bac-clr">
                <!-- <a class="small-header-action" href="">
                    <div class="clip-header">
                        <i class="fa fa-arrow-up"></i>
                    </div>
                </a> -->
                <div>
                    <h3 style="display:inline;" class="font-light m-b-xs font-col">
                        <a href="/open-research-page/?tab_id=1" style="color:#FFFFFF;">Research</a> >
                    </h3>
                    <h4 style="display:inline;" class="font-light m-b-xs font-col">
                        Focus List
                    </h4>

                </div>

            </div>
        </div>
    </div>

    <div class="content animate-panel">
        <div class="hpanel hblue">
            <div class="panel-body">
                <div class="text-left m-b-md" id="wizardControl">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#tab-1"><h5>Focus List</h5></a></li>
                        <li class=""><a data-toggle="tab" href="#tab-2"><h5>Research Log</h5></a></li>
                    </ul>
                </div>

                <div class="tab-content">
                    <div id="tab-1" class="tab-pane active">

                        <div>
                            <legend class="lege">Focus List
                                <div class="pull-right">
                                    <a href="/open-research-page/?tab_id=1"
                                       class="btn btn-outline btn-danger2">Cancel</a>&nbsp;&nbsp;
                                    <button id="save_company"
                                            class="btn w-xs btn-outline btn-success wid">
                                        &nbsp;&nbsp;Save&nbsp;&nbsp;</button>
                                </div>
                            </legend>
                        </div>

                        <form role="form" name="focus_details" id="focus_details" method="POST">
                            <input type="hidden" value="{{ focus.id }}" name="company_id"></input>
                            <input type="text" id="flag" hidden="" value="focus">

                            <div class="row">
                                <div class="form-group col-lg-3">
                                    <label id="lbl_cname">Company/Security Name*</label>
                                    <input type="text" value="{{ focus.txt_company_name }}" autocomplete="off"
                                           name="txt_company_name"
                                           id="company_name"
                                           class="form-control" onblur="calc_msi()" required>
                                </div>

                                <div class="form-group col-lg-3">
                                    <label  id="lbl_cntry" >Country*</label>
                                    <select class="form-control js-source-states" required
                                            name="txt_country_name" autocomplete="off" id="txt_country_name" onchange="select_relevent_currency();">
                                        <!--   <option value="{{ focus.txt_country_name }}"
                                                    selected>{{ focus.txt_country_name.country_name }}</option> -->
                                        {% for country in country_list %}
                                            <option value="{{ country.country_id }}">{{ country.country_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group col-lg-3">
                                    <label id="lbl_currency">Currency*</label>
                                    <select autocomplete="off" class="form-control js-source-states" name="txt_currency_name"
                                            id="txt_currency_name" >
                                        <option value="" disabled selected></option>
                                        {% for currency in currency_obj %}
                                            <option value="{{ currency.currency_id }}">{{ currency.currency }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group col-lg-3">
                                    <label id="lbl_bt">Bloomberg Ticker*</label>
                                    <input type="text" value="{{ focus.txt_bloomberg_ticker }}" autocomplete="off"
                                           name="txt_bloomberg_ticker"
                                           id="txt_bloomberg_ticker"
                                           class="form-control" onblur="calc_msi()" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-lg-3">
                                    <label>Source</label><!-- <label id="lbl_sour" style="color:white">&nbsp Please Fill
                                    out</label> -->
                                    <input type="text" value="{{ focus.txt_source }}" autocomplete="off" id="txt_source"
                                           required
                                           class="form-control"
                                           name="txt_source">
                                </div>

                                <div class="form-group col-lg-3">
                                    <label  id="lbl_cap">Market Capital (USD)*</label>
                                    <input type="text" value="{{ focus.txt_mkt_cap|floatformat:2 }}" id="txt_mkt_cap"
                                           autocomplete="off" required
                                           name="txt_mkt_cap" onkeypress="return validateFloatKeyPress(this,event);"
                                           class="form-control">
                                </div>

                                <div class="form-group col-lg-3">
                                    <label id="lbl_dat">Daily Turnover (USD)*</label>
                                    <input type="text" value="{{ focus.txt_daily_turnover|floatformat:2 }}" id="txt_daily_turnover"
                                           autocomplete="off"
                                           name="txt_daily_turnover"
                                           onkeypress="return validateFloatKeyPress(this,event);"
                                           class="form-control">
                                </div>

                                <div class="form-group col-lg-3">
                                    <label>Valuation</label><!-- <label id="lbl_country" style="color:white">&nbsp Please
                                    Select Country</label> -->
                                    <input type="text" required value="{{ focus.txt_vt_price|floatformat:2 }}" id="txt_vt_price"
                                           autocomplete="off"
                                           name="txt_vt_price" onblur="calculation(); "
                                           onkeypress="return validateFloatKeyPress(this,event);"
                                           class="form-control">
                                </div>
                            </div>

                            <div class="row">


                                <div class="form-group col-lg-3">
                                    <label id="lbl_cmp">CMP*</label>
                                    <input type="text" value="{{ focus.txt_cmp|floatformat:2 }}" id="txt_cmp" onblur="calculation(); calc_msi();"
                                           autocomplete="off" name="txt_cmp"
                                           onkeypress="return validateFloatKeyPress(this,event);"
                                           class="form-control">
                                </div>

                                <div class="form-group col-lg-3">
                                    <label>Move Since Inception(Local)</label>
                                    <input type="text" value="{{ focus.txt_msi }}" autocomplete="off" name="txt_msi"
                                           id="txt_msi"
                                           class="form-control" readonly>
                                </div>

                                <div class="form-group col-lg-3">
                                    <label>Upside/Downside(%)</label><!-- <label id="lbl_pri" style="color:white">&nbsp Please
                                    Select Client Priority</label> -->
                                    <input type="text" value="{{ focus.txt_updn|floatformat:2 }}" id="txt_updn" readonly
                                           autocomplete="off" name="txt_updn"
                                           onkeypress="return validateFloatKeyPress(this,event);"
                                           class="form-control">

                                </div>

                                <div class="form-group col-lg-3">
                                    <label>Management Quality</label>
                                    <input type="text" value="{{ focus.txt_mgmt }}" id="txt_mgmt" autocomplete="off"
                                           class="form-control"
                                           name="txt_mgmt"></input>
                                </div>
                                <div class="row ">
					                    <br>
					                    <div class="col-lg-12">
					                        <div>
					                            <label>Miscellaneous</label><label id="lbl_upl" style="color:white">&nbsp You can
					                            Upload upto 10 attachments only</label>
					
					                            <div class="dropzone" style=" min-height: 50px; border-color: #e4e5e7 !important;"
					                                 id="my-focus-dropzone"></div>
					                             <input type="hidden" hidden="" value="{{ focus.attachment_id }}" class="form-control" id="attachment1" name="attachment1"> 
					                             <input type="hidden" hidden="" class="form-control" id="attachments1" name="attachments1"> 
					                            <input type="hidden" value="{{ focus.attachment }}" class="form-control" id="image_list" name="image_list" />
					                            <input type="hidden" value="{{ focus.attachment_id }}" class="form-control" id="image_count" name="image_count" />
					                             
					                        </div>
					                    </div>
                					</div>
				                 <div class="row ">
				                 <br>
				                    <div class="col-lg-12">
				                        <div>
				                            <label>Download Attachment(s)</label>
				                             <div id="attch"></div>
				                        </div>
				                    </div>
				                </div>
                           </div>
                        </form>
                    </div>
                    <div id="tab-2" class="tab-pane ">
                    			<div class="text-right m-t-xs">
                    				<a type="button" class="btn w-xs btn-outline btn-primary2 wid" data-toggle="modal"
                                   data-target="#addLog" onclick="change_flag();">Add</a>
                    			</div>
                        <div>
                            <table class="table table-striped" id="communication_table">
                                <thead>
                                <tr>
                                    <th><span>Date</span></th>
                                    <th><span>Type</span></th>
                                    <th class="text-center"><span>Read More</span></th>
                                    <th class="text-center"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for comm in communication_list %}
                                    <tr>
                                        <td>{{ comm.comm_date }}</td>
                                        <td>{{ comm.comm_type }}
                                        </td>
                                        <td class="text-center">
                                            <button type="button" id="{{ comm.comm_id }}"
                                                    class="btn btn-default btn-success btn-xs btn-outline"
                                                    onclick="readmore(this)"> Read More
                                            </button>
                                        </td>
                                        <td><a id="{{ comm.comm_id }}" onclick=opencommunication(this.id)
                                               class="infont">
                                            <i class="fa fa-edit"></i></a></td>

                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-----------------------------------------------------ADD NEW LOG-------------------------------------------->

<div class="modal fade" id="addLog" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <form id="addNewLog" method="POST">
                    <div class="row">
                        <input type="hidden" id="addId" value={{ focus.id }} name="company_id">
                        

                        <h3 style="text-align:center">Research Log</h3>
                        <input hidden type="text" name="desc_date" id="addDescDate">

                        <div class="form-group col-lg-6">
                            <label>Date*</label>
                            <!-- <label id="lbl_cdate" style="color:white">&nbsp Select Date</label> -->

                            <div class="input-group date">
                                <input type="text" class="form-control" readonly name="cdate" id="addDate">
                                    	<span class="input-group-addon">
                                    	<i class="glyphicon glyphicon-th"></i>
                                    	</span>
                            </div>
                        </div>

                        <div class="form-group col-lg-6">
                            <label id="lbl_addT">Type*</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <select class="form-control js-source-states" name="select_contact_type"
                                    id="add_select_contact_type">
                                <option value='' disabled selected></option>
                                {% for types in com_types %}
                                    <option value="{{ types.communicationtype_id }}">{{ types.communicationtype_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- <div class="form-group col-lg-4">
                            <label id="port_lbl_zamp">Zeus Personnel* </label>
                            <select class="form-control js-source-states" name="zam_person" id="port_zam_person">
                                <option value='' disabled selected></option>
                                {% for zam_contacts in zam_contact_person_list %}
                                    <option value="{{ zam_contacts.zam_contact_person }}">{{ zam_contacts.zam_person_name }}</option>
                                {% endfor %}
                            </select>
                        </div> -->
                    </div>
                    
                    <div id="addDiv1">  
                    <div class="row">
                    		<div class="form-group col-lg-6">
                            <label id="lbl_addC">Company Personnel*</label>
                            <input type="text" name="company_personnel" id="addC" class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label>Designation</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input name="designation" id="addD" type="text" class="form-control"></input>
                        </div>
                     </div>
                   </div>     
                     
                   <div id="addDiv2">  
                     <div  class="row">
                    		<div class="form-group col-lg-6">
                            <label id="lbl_addB">Bank*</label>
                            <input type="text" name="bank" id="addB" class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label id="lbl_addA">Analyst*</label>
                            <input type="text" name="analyst" id="addA" class="form-control"></input>
                        </div>
                     </div>
                   </div>


                    <div class="row">
                        <div class="form-group col-lg-12">
                            <label>Description</label>
															<textarea style="resize: none;" class="form-control"
                                                                      id="adddesc" name="cdesc">
                                       		</textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-lg-12">
                            <div>
                                <label>Upload Attachment</label><label id="addUp" style="color:white">&nbsp You
                                can
                                Upload upto 10 attachments only</label>

                                <div class="dropzone" style=" min-height: 70px; border-color: #e4e5e7 !important;"
                                     id="my-port-dropzone"></div>
                                <input type="hidden" class="form-control" id="addAtt1" name="attachment">
                                <input type="hidden" class="form-control" id="addAtt" name="attachments">
                            </div>
                        </div>
                    </div>

                    <div class="text-right m-t-xs">
                        <button type="button" class="btn btn-outline btn-danger" data-dismiss="modal">Cancel</button>
                        <button type="button" id="new_save_com" class="btn  btn-outline btn-success wid"
                                data-dismiss="modal">&nbsp;Save&nbsp;</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!------------------------------------------END--------------------------------------------------------------->
<!---------READ MORE------------>


<div class="modal fade" id="readmore_box" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <form id="" method="POST">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="form-group col-lg-6">
                            <label>Date*</label><br>
                            <input type="text" readonly id="vw_com_date" class="form-control"></input>
                        </div>
                        <div class="form-group col-lg-6">
                            <label>Type</label><br>
                            <input type="text" id="vw_com_type" readonly class="form-control"></input>
                        </div>

                        <!-- <div class="form-group col-lg-4">
                            <label>Zeus Personnel*</label><br>
                            <input type="text" id="vw_zam_com_person" readonly class="form-control"></input>
                        </div> -->
                    </div>
                    
                    <div id="fseemore">  
                    <div class="row">
                    		<div class="form-group col-lg-6">
                            <label>Company Personnel</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input type="text" name="company_personnel" readonly id="vw_com_personel" class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label>Designation</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input type="text" id="vw_designation" readonly name="designation" class="form-control"></input>
                        </div>
                     </div>
                   </div>     
                     
                   <div id="fseemore1">  
                     <div  class="row">
                    		<div class="form-group col-lg-6">
                            <label>Bank</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input type="text" id="vw_bank" name="bank" readonly class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label>Analyst</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input type="text" id="vw_analyst" name="analyst" readonly class="form-control"></input>
                        </div>
                     </div>
                   </div>


                    <div class="row">
                        <div class="form-group col-lg-12">
                            <label>Description</label><br/>
                            <textarea id="vw_com_desc" style="resize: none;" readonly class="form-control"></textarea>
                        </div>
                    </div>

                    <div id="vw_com_att" class="row">
                        <div class="form-group col-lg-12">
                            <label>Attachment</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline btn-danger" data-dismiss="modal">Close</button>

                </div>
            </div>
        </form>
    </div>
</div>

<!----------------- Modal for Add Log in Focus List   -->



<!----------------- Modal for Add Communication   -->

<div class="modal fade" id="add_Communication" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <form id="communication" method="POST">
                    <div class="row">
                        <input type="hidden" id="comm_type_id" name="comm_type_id">
                        <input type="hidden" id="company_id" name="company_id">

                        <h3 style="text-align:center">Research Log</h3>
                        <input hidden type="text" name="desc_date" id="desc_date">

                        <div class="form-group col-lg-6">
                            <label id="lbl_cdate">Date*</label>
                            <!-- <label id="lbl_cdate" style="color:white">&nbsp Select Date</label> -->

                            <div class="input-group date">
                                <input type="text" class="form-control" readonly name="cdate" id="cdate">
                                    	<span class="input-group-addon">
                                    	<i class="glyphicon glyphicon-th"></i>
                                    	</span>
                            </div>
                        </div>

                        <div class="form-group col-lg-6">
                            <label>Type</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <select class="form-control js-source-states" name="select_contact_type"
                                    id="select_contact_type">
                                <option value='' disabled selected></option>
                                {% for types in com_types %}
                                    <option value="{{ types.communicationtype_id }}">{{ types.communicationtype_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- <div class="form-group col-lg-4">
                            <label id="lbl_zamp">Zeus Personnel* </label>
                            <select class="form-control js-source-states" name="zam_person" id="zam_person">
                                <option value='' disabled selected></option>
                                {% for zam_contacts in zam_contact_person_list %}
                                    <option value="{{ zam_contacts.zam_person_id }}">{{ zam_contacts.zam_person_name }}</option>
                                {% endfor %}
                            </select>
                        </div> -->
                    </div>
                    
                    <div id="fcompanypersonnel">  
                    <div class="row">
                    		<div class="form-group col-lg-6">
                            <label id="lbl_fcp">Company Personnel*</label>
                            <input type="text" name="company_personnel" id="focompany_personnel" style="display:block!important;" class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label>Designation</label>
                            <!-- <label id="lbl_ctype" style="color:white">&nbsp Select Type</label> -->
                            <input type="text" id="fdesignation" name="designation" class="form-control"></input>
                        </div>
                     </div>
                   </div>     
                     
                   <div id="fdbank">  
                     <div  class="row">
                    		<div class="form-group col-lg-6">
                            <label id="lbl_fb">Bank*</label>
                            <input type="text" id="fbank" name="bank" class="form-control"></input>
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label id="lbl_fa">Analyst*</label>
                            <input type="text" id="foanalyst" name="analyst" class="form-control"></input>
                        </div>
                     </div>
                   </div>
                    
                                        

                    <div class="row">
                        <div class="form-group col-lg-12">
                            <label>Description</label><label id="lbl_cdesc" style="color:white">&nbsp Fill out
                            Description</label>
															<textarea style="resize: none;" class="form-control"
                                                                      id="cdesc" name="cdesc">
                                       		</textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-lg-12">
                            <div>
                                <label>Upload Attachment(s)</label><label id="lbl_uupl" style="color:white">&nbsp You can
                                Upload upto 10 attachments only</label>

                                <div class="dropzone" style=" min-height: 70px; border-color: #e4e5e7 !important;"
                                     id="my-awesome-dropzone"></div>
                                <input type="hidden" class="form-control" id="attachment" name="attachment">
                                <input type="hidden" class="form-control" id="attachments" name="attachments">
                            </div>
                        </div>
                    </div>


                    <div class="text-right m-t-xs">
                        <button type="button" class=" btn btn-outline btn-danger" data-dismiss="modal">Cancel
                        </button>
                        <button type="button" id="save_com" class="btn  btn-outline btn-success wid"
                                 onclick="update_log()">&nbsp;Save&nbsp;</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-------------END------------------->

<!-- Vendor scripts -->
<script src="{% static 'vendor/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'vendor/jquery-ui/jquery-ui.min.js' %}"></script>
<script src="{% static 'vendor/slimScroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/dist/js/bootstrap.min.js' %}"></script>
<script src="{% static 'vendor/metisMenu/dist/metisMenu.min.js' %}"></script>
<script src="{% static 'vendor/iCheck/icheck.min.js' %}"></script>
<script src="{% static 'vendor/sparkline/index.js' %}"></script>
<script src="{% static 'vendor/sparkline/validator.js' %}"></script>
<script src="{% static 'vendor/sweetalert/lib/sweet-alert.min.js' %}"></script>
<script src="{% static 'vendor/select2-3.5.2/select2.min.js' %}"></script>
<script src="{% static 'vendor/jquery-validation/jquery.validate.min.js' %}"></script>
<script src="{% static 'custom-js/research.js' %}"></script>
<script src="{% static 'vendor/datatables/media/js/jquery.dataTables.js' %}"></script>
<script src="{% static 'vendor/datatables_plugins/integration/bootstrap/3/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'vendor/moment/dropzone1.js' %}"></script>
<script src="{% static 'vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js' %}"></script>


<!-- App scripts -->
<script src="{% static 'scripts/homer.js' %}"></script>

<script>

	function change_flag() {
		$("#flag").val("log");
	}
	
	$('#addLog').on('hidden.bs.modal', function () {
   	$("#flag").val("focus");
	})

	$('#add_Communication').on('hidden.bs.modal', function () {
   	$("#flag").val("focus");
	})

    $(function () {
    
    			$('#addLog').on('shown.bs.modal', function () {
           	$('#add_select_contact_type').select2().select2("val", '');
            $('#adddesc').val("");
            $('#lbl_addT').css("color", "#6A6C6F");
				$('#lbl_addC').css("color", "#6A6C6F");
				$('#lbl_addB').css("color", "#6A6C6F");
				$('#lbl_addA').css("color", "#6A6C6F");
				$("#addDiv1").hide();
    			$("#addDiv2").hide();
    			$('#addC').val("");
    			$('#addD').val("");
    			$('#addB').val("");
    			$('#addA').val("");

        });
    		
    		   $.fn.datepicker.defaults.format = "dd/mm/yyyy";
    			var currentDate = new Date();
    			$("#addDate").datepicker("setDate",currentDate);
    		 	$.fn.datepicker.defaults.endDate = "+0d";
    		 

    
    		/* show the div on chane of Type in Research Log*/
    		$('#select_contact_type').on('change', function() {
      		if ( $('#select_contact_type option:selected').text() == "Management")
     			 {  
        			$("#fcompanypersonnel").show();

      		}else{
					$("#fcompanypersonnel").hide();      
      		}
      		if ( $('#select_contact_type option:selected').text() == "Analyst")
      		{  
        			$("#fdbank").show();
      		}else{
					$("#fdbank").hide();      
      		}
    		});
    		/*--------end-------------*/

        $('#communication_table').dataTable({
         "columnDefs": [
                {"targets": 2, "orderable": false},
                {"targets": 3, "orderable": false}
            ],
            drawCallback: function () {
                var page_min = 10;
                var $api = this.api();
                var pages = $api.page.info().pages;
                var rows = $api.data().length;
                var page = $api.page.info().page;

                if (pages === 1) {
                    $('#communication_table_paginate').css('display', 'none').next('.dataTables_paginate').css('display', 'none');
                    $('#communication_table_next').css('display', 'none').next('.dataTables_paginate').css('display', 'none');
                    $('#communication_table_previous').css('display', 'none').next('.dataTables_paginate').css('display', 'none');
                } else if (page === 0) {
                    $('#communication_table_previous').css('display', 'none').next('.dataTables_paginate').css('display', 'none');
                }
            }
        
        });
        $(".js-source-states").select2();
        $("#txt_country_name").select2("val", {{focus.txt_country_name.country_id}});
        $("#txt_currency_name").select2("val", {{focus.txt_currency_name.currency_id}});

        $.fn.datepicker.defaults.endDate = "+0d";
        $.fn.datepicker.defaults.format = "dd/mm/yyyy";
        $('.input-group.date').datepicker({}).on('changeDate', function (e) {
            $(this).datepicker('hide');
            $(this).datepicker({maxDate: 0});

        });
        
        /*---------------------------------ADD NEW LOG DROPZONE----------------------------------------------*/
        
			Dropzone.options.myPortDropzone = {
            autoProcessQueue: true,
            uploadMultiple: true,
            paramName: "file",
            maxFiles: 10,
            method: 'post',
            parallelUploads: 1,
            url: '/focus-files-upload/',
            dictDefaultMessage: "Drop or Browse up to 10 images (1MB or higher in size)",
            addRemoveLinks: true,
            acceptedFiles: '',
            dictInvalidFileType: 'This file type is not supported.',
            dictMaxFilesExceeded: "You can not upload more than 10 images.",

            
            init: function () {

                var myDropzone = this;
                var reordered_array = new Array();
                var temp_image_files = new Array();

                this.on("sending", function () {
                    return false;
                });
                
       		this.on("addedfile", function(file, response){
       	
          		if (myDropzone.files.length > 10){
             $('#addUp').css("color", "red");
             this.removeFile(file);  
         	}
         		temp_image_files.push(file);
       		});      
        

                //      var mainlenghtiszero = $('.dz-preview').length;
               this.on("success", function (files, response) {
        				
        				$('#addAtt').val($('#addAtt').val()+","+response.attachid);
             		$('a .dz-remove').attr('href','/focus-files-remove/?image_id='+response.attachid);
                    reordered_array.push(response.attachid);
                    
						  $('#addAtt').val(reordered_array);           
						  $('#addAtt1').val(reordered_array);           
                   
                });
                
                this.on("maxfilesexceeded", function (file) {

                    this.removeFiles(file);
                    $('#addUp').css("color", "red");

                });
                
                 this.on("removedfile", function(file){ 
							deleting_image_id = reordered_array[temp_image_files.indexOf(file)];
					
		          		$.ajax({url: "/focus-files-remove/?image_id="+deleting_image_id, success: function(result){
		                  arr = $('#addAtt').val();
		                  arr = arr.split(',');
		                  console.log('Before Id Remove : '+ arr);
		                  arr = jQuery.grep(arr, function(value) {
		                      return value != deleting_image_id;
		              		 });
		                  console.log('After Id Remove : '+ arr);
		                  $('#addAtt').val(arr);
		          		}});
								arr =$('#addAtt1').val();
	        					arr = arr.split(',');
	        					arr = jQuery.grep(arr, function(value) {
	        							return value != deleting_image_id;
							   });
	
	        					$('#addAtt1').val(arr);
								var index=myDropzone.files.length;
								var temp_image_id = reordered_array[temp_image_files.indexOf(file)];
								
								reordered_array = jQuery.grep(reordered_array, function(value) {
	        							return value != temp_image_id;
							   });
							   
							   temp_image_files = jQuery.grep(temp_image_files, function(value) {
	        							return value != file;
							   }); 
							   $('#addAtt1').val(reordered_array); 		          		
          		});

                
            }
        }        
        
        /*-----------------------------------END---------------------------------------*/
        
                /*------------------------------------Dropzone to View the attachments---------------------*/
         Dropzone.options.myFocusDropzone = {
        autoProcessQueue: true,
        uploadMultiple: false,
        paramName: "file",
        maxFiles: 10,
        method:'post', 
        parallelUploads:1, 
        url:'/update-focus-file-upload/',
        dictDefaultMessage: "",
        addRemoveLinks:true,
        acceptedFiles: '',
        dictInvalidFileType: 'This file type is not supported.',
        thumbnailWidth: 10,
  		  thumbnailHeight: 10,
      
        // The setting up of the dropzone
        init: function() {
         var myDropzone = this;
         var reordered_array = new Array();
         var temp_image_files = new Array();
         /*
          This is done by ManojB, do not change anything
         */
         var image_ids = $('#attachment1').val(); //add.............................
         // alert(image_ids);
         
         if(image_ids != ""){
          image_ids = image_ids.split(',');
           var productImages= $('#image_list').val();   // getting the list from hidden field
           productImages = productImages.replace('[',''); // removing '[' , ']' & (') character from list and  
           productImages = productImages.replace(']','');
           productImages = productImages.replace(/&#39;/g,'');
           productImages = productImages.replace(/'/g, '');
           productImages = productImages.split(',');  // split the string so that it form javascript array
           
          for (var i = 0; i < productImages.length; i++) {
          			var filen = productImages[i];    			
          			filen = filen.split('/');
          			
                  var mockFile = { 
                      name: filen[6], 
                      size: 12345, 
                      type: 'image/jpeg', 
                      status: Dropzone.ADDED, 
                      url: productImages[i],
                      image_id : image_ids[i]
                  };
  
  						reordered_array.push(image_ids[i]); //add.............................
                  // Call the default addedfile event handler
                  myDropzone.emit("addedfile", mockFile);
  
                  // And optionally show the thumbnail of the file:
                  
						//alert(filen);                  
                  
                  var ext = filen[6].split('.').pop();
                 
                  if (ext == "jpg" || ext == "tif" || ext == "gif" || ext == "png") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/jpeg.jpg' %}");
                  }
                  else if (ext == "xls" || ext == "xlsx" || ext == "csv") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/Excel-icon.png' %}");
                  }
						else if (ext == "doc" || ext == "docx" || ext == "docm" || ext == "dotm") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/Word.ico' %}");
                  }
						else if (ext == "txt") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/txt-512.jpg' %}");
                  }
						else if (ext == "ppt" || ext == "pptx") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/PowerPoint-icon.png' %}");
                  }
                                    else if (ext == "pdf") {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/pdf-file.png' %}");
                  }
                  else {
                  	myDropzone.emit("thumbnail", mockFile, "{% static 'extensions/fileicon.png' %}");	
                  }
                                   
                 $('#attch').append('<div class="col-lg-6"><li><a  title="Download Document"  href=' + productImages[i] + ' download = ' + filen[6] + '  target="_blank"><span>' + " " + filen[6] + '</span></a></li></div>');
            
            // $('#test_reordered_images').val($('#test_reordered_images').val()+image_ids[i]+",");
            // reordered_array.push(image_ids[i]);
            temp_image_files.push(mockFile); //add.............................
                  myDropzone.files.push(mockFile);
             $('#reordered_images').val(reordered_array);
              }
           }
           // else{
           // 		// If first time list comes empty then reset the image_count
           // 		$('#image_count').val('');
           // }
      /* @Author ManojB : This is custom file add event for checking the file is getting added or not   */  
        this.on("addedfile", function(file, response){
        
        	
          if (myDropzone.files.length > 10){
              $('#lbl_upl').css("color", "red");
              this.removeFile(file);  
          }
          temp_image_files.push(file);
        });       
        
          // Listen to the sendingmultiple event. In this case, it's the sending multiple event instead
          // of the sending event because uploadMultiple is set to true.
          this.on("sending", function() {
            // Gets triggered when the form is actually being sent.
            // Hide the success button or the complete form.
            return false;
          });
          
        			this.on("success", function (files, response) {
        				
        				$('#attachment1').val($('#attachment1').val()+","+response.attachid);
             		$('a .dz-remove').attr('href','/remove-focuslistmisc-image/?image_id='+response.attachid);
                    reordered_array.push(response.attachid);
                    
						  $('#attachment1').val(reordered_array);           
						  $('#attachments1').val(reordered_array);           
                   
                }); //add.............................

                this.on("maxfilesexceeded", function (file) {
                    this.removeFile(file);
                    $('#lbl_upl').css("color", "red");
                });

        /* @Author ManojB
          This is for removing file
         */

        this.on("removedfile", function(file){ 
                
			deleting_image_id = reordered_array[temp_image_files.indexOf(file)];
			
          $.ajax({url: "/remove-focuslistmisc-image/?image_id="+deleting_image_id, success: function(result){
                  arr = $('#attachment1').val();
                  arr = arr.split(',');
                  console.log('Before Id Remove : '+ arr);
                  arr = jQuery.grep(arr, function(value) {
                      return value != deleting_image_id;
              		 });
                  console.log('After Id Remove : '+ arr);
                  $('#attachment1').val(arr);
          }});
          
							arr =$('#attachments1').val();
        					arr = arr.split(',');
        					arr = jQuery.grep(arr, function(value) {
        							return value != deleting_image_id;
						   });

        					$('#attachments1').val(arr);
							var index=myDropzone.files.length;
							var temp_image_id = reordered_array[temp_image_files.indexOf(file)];
							
							reordered_array = jQuery.grep(reordered_array, function(value) {
        							return value != temp_image_id;
						   });
						   
						   temp_image_files = jQuery.grep(temp_image_files, function(value) {
        							return value != file;
						   }); 
						   $('#attachment1').val(reordered_array);          
          
          }); //add.............................
        }
      }
      
        /*-------------------------------end--------------------------------------------------------*/

        Dropzone.options.myAwesomeDropzone = {
            autoProcessQueue: true,
            uploadMultiple: true,
            paramName: "file",
            maxFiles: 10,
            method: 'post',
            parallelUploads: 1,
            url: '/focus-files-upload/',
            dictDefaultMessage: "Drop or Browse up to 10 images (1MB or higher in size)",
            addRemoveLinks: true,
            acceptedFiles: '',
            dictInvalidFileType: 'This file type is not supported.',
            dictMaxFilesExceeded: "You can not upload more than 10 images.",

            init: function () {

                var myDropzone = this;
                var reordered_array = new Array();
                var temp_image_files = new Array();

                this.on("sending", function () {
                    return false;
                });
                
        this.on("addedfile", function(file, response){
        
        	
          if (myDropzone.files.length > 10){
              $('#lbl_uupl').css("color", "red");
              this.removeFile(file);  
          }
          temp_image_files.push(file);
        });                   


                //      var mainlenghtiszero = $('.dz-preview').length;
               this.on("success", function (files, response) {
        				
        				$('#attachment').val($('#attachment').val()+","+response.attachid);
             		$('a .dz-remove').attr('href','/focus-files-remove/?image_id='+response.attachid);
                    reordered_array.push(response.attachid);
                    
						  $('#attachment').val(reordered_array);           
						  $('#attachments').val(reordered_array);           
                   
                });
                
                 this.on("removedfile", function(file){ 
							deleting_image_id = reordered_array[temp_image_files.indexOf(file)];
					
		          		$.ajax({url: "/focus-files-remove/?image_id="+deleting_image_id, success: function(result){
		                  arr = $('#attachment').val();
		                  arr = arr.split(',');
		                  console.log('Before Id Remove : '+ arr);
		                  arr = jQuery.grep(arr, function(value) {
		                      return value != deleting_image_id;
		              		 });
		                  console.log('After Id Remove : '+ arr);
		                  $('#attachment').val(arr);
		          		}});
								arr =$('#attachments').val();
	        					arr = arr.split(',');
	        					arr = jQuery.grep(arr, function(value) {
	        							return value != deleting_image_id;
							   });
	
	        					$('#attachments').val(arr);
								var index=myDropzone.files.length;
								var temp_image_id = reordered_array[temp_image_files.indexOf(file)];
								
								reordered_array = jQuery.grep(reordered_array, function(value) {
	        							return value != temp_image_id;
							   });
							   
							   temp_image_files = jQuery.grep(temp_image_files, function(value) {
	        							return value != file;
							   }); 
							   $('#attachments').val(reordered_array); 		          		
          		});


            }
        }
        
        /*--------------------------ADD NEW LOG SAVE FUNCTION------------------------- */
        
        $("#new_save_com").click(function (e) {

        
        var dates = new Date();
        dates = dates.toString();
        date = dates.split(" ");
        var time = formatAMPM();
        var date = date[0] + " " + date[2] + " " + date[1] + " " + date[3] + " " + time
        $("#addDescDate").val(date);
        $.fn.datepicker.defaults.endDate = "+0d";

        
        //alert(attachment);


            
            if ($('#add_select_contact_type option:selected').val() === "" || $('#add_select_contact_type option:selected').val ===null) {
                $('#lbl_addT').css("color", "red");
                
                return false;
            } else {
                $('#lbl_addT').css("color", "#6A6C6F");
            }
            
         
            
            if ( $('#add_select_contact_type option:selected').text() == "Management"){
            	if ($('#addC').val() === "") {
                $('#lbl_addC').css("color", "red");
                return false;
            	}else{
                $('#lbl_addC').css("color", "#6A6C6F");
            	} 
            }
            
            if ( $('#add_select_contact_type option:selected').text() == "Analyst"){
            	if ($('#addB').val() === "") {
                $('#lbl_addB').css("color", "red");
            	}else{
                $('#lbl_addB').css("color", "#6A6C6F");
            	}
            	
            	if ($('#addA').val() === "") {
                $('#lbl_addA').css("color", "red");
                return false;
            	}else{
                $('#lbl_addA').css("color", "#6A6C6F");
            	} 
            	
            	if ($('#addB').val() === "" || $('#addA').val() === ""){
            	return false;
            	}
            }
            
               if ($("#add_select_contact_type option:selected").val() != "") {
            		if ($("#adddesc").val()==""  && $("#addAtt1").val() == "" ) {
                	alert("Please either Fill Out Description or Upload the attachment");
                	return false;
            		}
        			}



        $.ajax({
            type: 'POST',
            url: '/save-focuslog/',
            data: $("#addNewLog").serialize(),
            success: function (response) {
                if (response.success == 'true') {
                    location.reload()
                }
            },
            error: function (response) {
                console.log(response);
                alert("Error");
            },
            beforeSend: function () {
                $("#load").show();
            },
            error: function (response) {
                console.log(response);
                alert('error');
                $("#load").hide();
            },
            complete: function () {
                $("#load").hide();
            }


        });


    });
        
        /*---------------------------END------------------------------------------------*/

        $('#save_company').click(function () {
            company_validation();

            $.ajax({
                type: 'POST',
                url: '/update-focuslist-company/',
                data: $('#focus_details').serialize(),
                success: function (response) {
                    if (response.success == 'true') {
                        location.href = "/open-research-page/?tab_id=1";
                    }
                },
                error: function (response) {
                    console.log(response);
                    alert("Error");
                }
            });

        });


    });

    function validateFloatKeyPress(el, evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        var number = el.value.split('.');
        if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }

        if (number.length > 1 && charCode == 46) {
            return false;
        }

        var caratPos = getSelectionStart(el);
        var dotPos = el.value.indexOf(".");
        if (caratPos > dotPos && dotPos > -1 && (number[1].length > 1)) {
            if (charCode == 8)
                return true;
            else
                return false;
        }
        return true;
    }

    //thanks: http://javascript.nwbox.com/cursor_position/
    function getSelectionStart(o) {
        if (o.createTextRange) {
            var r = document.selection.createRange().duplicate()
            r.moveEnd('character', o.value.length)
            if (r.text == '') return o.value.length
            return o.value.lastIndexOf(r.text)
        } else return o.selectionStart
    }

    function calculation() {
        var cmp;
        var count;
        var updn;
        var vt;

        if ($('#txt_vt_price').val() === "" || $('#txt_vt_price').val() === null) {
            $('#txt_vt_price').val("0");
        }

        if ($('#txt_cmp').val() == 0) {
            $("#txt_updn").val("undefined");
        }
        else {
            vt = $('#txt_vt_price').val();
            cmp = $('#txt_cmp').val();
            updn = vt / cmp;
            updn = (updn - 1) * 100;
            updn = updn.toFixed(2);
            $("#txt_updn").val(updn);
        }
    }

    function readmore(id_val) {
        $('#attachment_list').empty();
        $.ajax({
            type: 'GET',
            url: '/get-focus-communication-msg/',
            data: {'communication_id': $(id_val).attr("id")},
            success: function (response) {
                console.log(response)
                if (response.success == 'true') {
                    $('#vw_com_date').val(response.communication_date);
                    $('#vw_com_type').val(response.communication_type);
                    $('#vw_zam_com_person').val(response.zam_contact_person);
                    $('#vw_com_personel').val(response.company_personel);
                    $('#vw_designation').val(response.designation);
                    $('#vw_bank').val(response.bank_name);
                    $('#vw_analyst').val(response.analyst_name);
                    $('#vw_com_desc').text(response.communication_desc);
              
                     if( response.communication_type == "Management")
			     			 {  
			        			$("#fseemore").show();
								$("#fseemore1").hide();
			      		} 
			      		if( response.communication_type == "Analyst")
			     			 {  
			        			$("#fseemore").hide();
								$("#fseemore1").show();
			      		}
			      		if( response.communication_type == "Other")
			     			 {  
			        			$("#fseemore").hide();
								$("#fseemore1").hide();
			      		}
			      		
                    var attachment = response.attachment.toString()
                    var file_name = response.file_name.toString()
                    attachment = attachment.split(",");
                    file_name = file_name.split(",");
                    $('#vw_com_att').html('')
                    $('#vw_com_att').append(' <label>Attachment(s)</label>');
                    for (i = 0; i < attachment.length; i++) {
                        file_path = attachment[i]
                        file = file_name[i]
                        $('#vw_com_att').append('<li><a  title="Download Document"  href=' + file_path + ' download = ' + file + '  target="_blank"><span>' + " " + file + '</span></a></li>');
                    }
                    $("#readmore_box").modal('show');
                }
            },
            error: function (response) {
                console.log("Error" + response);
            }

        });
    }

    function select_relevent_currency() {
        var id = $("#txt_country_name").val();
        $.ajax({
            type: "GET",
            url: '/add-currency-security/',
            data: {'id': id},
            success: function (response) {
                if (response.success == "true") {
                    $.each(response.result, function (index, item) {
                    		$("#txt_currency_name").select2("val", item.id );
                    });
                }
            },
            error: function (response) {
                console.log(response);
            },
        });
    }

    function calc_msi() {
        var txt_company_name = $("#company_name").val();
        var txt_bloomberg_ticker = $("#txt_bloomberg_ticker").val();
        var txt_cmp = $("#txt_cmp").val();
        if (txt_bloomberg_ticker == "" || txt_company_name == "" || txt_cmp=="") {
            $("#txt_msi").val("undefined");
            return false;
        }
        else {
            $.ajax({
                type: 'POST',
                url: '/get-price-msi/',
                data: {'sec_name':txt_company_name,'bloomberg_ticker':txt_bloomberg_ticker},
                success: function (response) {
                    console.log(response);
                    if(response.success == "true"){
                        var price = response.price
                        var fx_rate = response.fx_rate
                        var cmp = (txt_cmp/fx_rate)
                        price = (price/fx_rate)
                        var msi = cmp/price
                        msi = msi - 1;
                        msi = msi.toFixed(2);
                        $("#txt_msi").val(msi);
                    }
                    else{
                        $("#txt_msi").val("undefined");
                    }

                },
                error: function (response) {
                    console.log(response);
                    alert("Error");
                    $("#txt_msi").val("undefined");
                },
            });
        }
    }

        function opencommunication(id) {
        //alert(id);
        $("#add_Communication").modal('show');
        $("#flag").val("Edit_log");

        $('#lbl_fcp').css("color", "#6A6C6F");
        $('#lbl_fb').css("color", "#6A6C6F");
        $('#lbl_fa').css("color", "#6A6C6F");
        
        $.ajax({
            type: 'POST',
            url: '/get-focus-researchlog/',
            data: {'active_log_id': id},
            success: function (response) {
                console.log(response)
                if (response.success == 'true') {
                    $('#cdate').val(response.comm_date);
                    $('#select_contact_type').select2("val", response.comm_type);
                    $('#comm_type_id').val(response.comm_type);
                    $('#zam_person').select2("val", response.comm_person);
                    $('#cdesc').val(response.comm_desc);
                    $('#focompany_personnel').val(response.company_personel);
                    $('#fdesignation').val(response.designation);
                    $('#fbank').val(response.bank_name);
                    $('#foanalyst').val(response.analyst_name);

                  if( response.comm_typename == "Management")
			     			 {  
			        			$("#fcompanypersonnel").show();
								$("#fdbank").hide();
			      		} 
			      	if( response.comm_typename == "Analyst")
			     			 {  
			        			$("#fcompanypersonnel").hide();
								$("#fdbank").show();
			      		}
			      	if( response.comm_typename == "Other")
			     			 {  
			        			$("#fcompanypersonnel").hide();
								$("#fdbank").hide();
			      		}	   
							                   
                    
                    
               		
                }
            },
            error: function (response) {
                console.log("Error" + response);
            }

        });
        $("#company_id").val(id);
    }

    //---------------------------end----------------------//

    //---------------------------end----------------------//
    function remove_file() {
    
    		var flag = $("#flag").val();

			if (flag=="focus") {
				var reordered_array = $('#attachment1').val();
        		reordered_array = reordered_array.split(",")
        		n = reordered_array.length;
        		if (n == 1) {
            	$('#attachment1').val("");
        		}
        		else {
            	reordered_array = reordered_array.pop();
            	$('#attachment1').val(reordered_array)
        		}	
			}else if (flag == "log") {
				var reordered_array = $('#addAtt1').val();
        		reordered_array = reordered_array.split(",")
        		n = reordered_array.length;
        		if (n == 1) {
            	$('#addAtt1').val("");
        		}
        		else {
            	reordered_array = reordered_array.pop();
            	$('#addAtt1').val(reordered_array)
        		}					
			}else {
				var reordered_array = $('#attachments').val();
        		reordered_array = reordered_array.split(",")
        		n = reordered_array.length;
        		if (n == 1) {
            	$('#attachments').val("");
        		}
        		else {
            	reordered_array = reordered_array.pop();
            	$('#attachments').val(reordered_array)
        		}					
			}
    }
    
     

    function formatAMPM() {
        var date = new Date()
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0' + minutes : minutes;
        var strTime = hours + ':' + minutes + ' ' + ampm;
        return strTime;
    }

    function update_log() {
        var id = $("#company_id").val();
        var comm_date = $('#cdate').val();
        var comm_type = $('#select_contact_type :selected').val();
        var comm_type_id = $('#comm_type_id').val();
        var comm_person = $('#zam_person :selected').val();
        var comm_desc = $('#cdesc').val();
        var dates = new Date();
        dates = dates.toString();
        date = dates.split(" ");
        var time = formatAMPM();
        var date = date[0] + " " + date[2] + " " + date[1] + " " + date[3] + " " + time
        $('#desc_date').val(date);
        
         if ( $('#select_contact_type option:selected').text() == "Management"){
            	if ($('#focompany_personnel').val() === "") {
                $('#lbl_fcp').css("color", "red");
                return false;
            	}else{
                $('#lbl_fcp').css("color", "#6A6C6F");
            	} 
            }
            
            if ( $('#select_contact_type option:selected').text() == "Analyst"){
            	if ($('#fbank').val() === "") {
                $('#lbl_fb').css("color", "red");
            	}else{
                $('#lbl_fb').css("color", "#6A6C6F");
            	}
            	
            	if ($('#foanalyst').val() === "") {
                $('#lbl_fa').css("color", "red");
                return false;
            	}else{
                $('#lbl_fa').css("color", "#6A6C6F");
            	} 
            	
            	if ($('#fbank').val() === "" || $('#foanalyst').val() === ""){
            	return false;
            	}
            }


        $.ajax({
            type: 'POST',
            url: '/update-focus-researchlog/',
            data: $("#communication").serialize(),
            success: function (response) {
                console.log(response)
                if (response.success == 'true') {
                		 $('#add_Communication').modal("hide");
                    location.reload()
                }
            },
            error: function (response) {
                console.log("Error" + response);
            }

        });
    }
    //---------------------------end----------------------//


</script>

</body>
</html>
                                        